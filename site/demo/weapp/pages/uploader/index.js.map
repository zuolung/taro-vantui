{"version":3,"file":"pages/uploader/index.js","sources":["webpack:///._src_pages_uploader_index.js","webpack:///._node_modules_core-js_internals_string-multibyte.js","webpack:///._node_modules_core-js_modules_es.string.iterator.js","webpack:///./src/pages/uploader/index.js?a970","webpack:///._src_pages_uploader_index.scss"],"sourcesContent":["import { Block, View } from '@tarojs/components'\nimport React from 'react'\nimport Taro from '@tarojs/taro'\n\nimport { Uploader, Button } from 'taro-vantui'\n\nimport DemoBlock from '../../components/demo-block/index'\nimport './index.scss'\n\nexport default class Index extends React.Component {\n  constructor() {\n    super()\n  }\n\n  state = {\n    fileList1: [],\n    fileList2: [\n      { url: 'https://img.yzcdn.cn/vant/leaf.jpg' },\n      { url: 'https://img.yzcdn.cn/vant/tree.jpg' },\n    ],\n    fileList3: [{ url: 'https://img.yzcdn.cn/vant/sand.jpg' }],\n    fileList4: [],\n    fileList5: [],\n    fileList6: [],\n    cloudPath: [],\n    fileList7: [],\n    fileList8: [\n      {\n        url: 'https://img.yzcdn.cn/vant/leaf.jpg',\n        status: 'uploading',\n        message: '上传中',\n      },\n      {\n        url: 'https://img.yzcdn.cn/vant/tree.jpg',\n        status: 'failed',\n        message: '上传失败',\n      },\n    ],\n  }\n\n  beforeRead = (event) => {\n    const { file, callback = () => {} } = event.detail\n    if (file && file.url && file.url.indexOf('jpeg') < 0) {\n      Taro.showToast({ title: '请选择jpg图片上传', icon: 'none' })\n      callback(false)\n      return\n    }\n    callback(true)\n  }\n\n  afterRead = (event) => {\n    const { file, name } = event.detail\n    console.log(JSON.stringify(file, null, 2))\n    const fileList = this.state[`fileList${name}`]\n\n    this.setState({ [`fileList${name}`]: fileList.concat(file) })\n  }\n\n  oversize = () => {\n    Taro.showToast({ title: '文件超出大小限制', icon: 'none' })\n  }\n\n  delete = (event) => {\n    const { index, name } = event.detail\n    const fileList = this.state[`fileList${name}`]\n    const _fileList = JSON.parse(JSON.stringify(fileList))\n    _fileList.splice(index, 1)\n    this.setState({ [`fileList${name}`]: _fileList })\n  }\n\n  clickPreview = () => {}\n\n  uploadToCloud = () => {\n    Taro.cloud.init()\n    const { fileList6: fileList = [] } = this.state\n    if (!fileList.length) {\n      Taro.showToast({ title: '请选择图片', icon: 'none' })\n    } else {\n      const uploadTasks = fileList.map((file, index) =>\n        this.uploadFilePromise(`my-photo${index}.png`, file),\n      )\n      Promise.all(uploadTasks)\n        .then((data) => {\n          Taro.showToast({ title: '上传成功', icon: 'none' })\n          const fileList = data.map((item) => ({ url: item.fileID }))\n          this.setState({ cloudPath: data, fileList6: fileList })\n        })\n        .catch((e) => {\n          Taro.showToast({ title: '上传失败', icon: 'none' })\n          console.log(e)\n        })\n    }\n  }\n\n  uploadFilePromise = (fileName, chooseResult) => {\n    return Taro.cloud.uploadFile({\n      cloudPath: fileName,\n      filePath: chooseResult.path,\n    })\n  }\n\n  render() {\n    const {\n      fileList1,\n      fileList7,\n      fileList2,\n      fileList8,\n      fileList3,\n      fileList4,\n      fileList5,\n      fileList6,\n    } = this.state\n    return (\n      <Block>\n        <DemoBlock title=\"基础用法\" padding>\n          <Uploader\n            name=\"1\"\n            fileList={fileList1}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"上传视频\" padding>\n          <Uploader\n            name=\"7\"\n            accept=\"video\"\n            fileList={fileList7}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"文件预览\" padding>\n          <Uploader\n            name=\"2\"\n            fileList={fileList2}\n            multiple\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"隐藏上传按钮\" padding>\n          <Uploader\n            name=\"2\"\n            fileList={fileList2}\n            multiple\n            showUpload={false}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"上传状态\" padding>\n          <Uploader\n            name=\"8\"\n            fileList={fileList8}\n            multiple\n            maxCount={2}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"限制上传数量\" padding>\n          <Uploader\n            name=\"3\"\n            fileList={fileList3}\n            multiple\n            maxCount={2}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"自定义上传样式\" padding>\n          <Uploader\n            name=\"4\"\n            fileList={fileList4}\n            maxCount={2}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n            useSlot={true}\n          >\n            <Button icon=\"photo\" type=\"primary\">\n              上传图片\n            </Button>\n          </Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"上传前校验\" padding>\n          <Uploader\n            name=\"5\"\n            fileList={fileList5}\n            onBeforeRead={this.beforeRead}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n            useBeforeRead={true}\n          ></Uploader>\n        </DemoBlock>\n        <DemoBlock title=\"云存储上传\" padding>\n          <Uploader\n            name=\"6\"\n            fileList={fileList6}\n            onBeforeRead={this.beforeRead}\n            onAfterRead={this.afterRead}\n            onDelete={this.delete}\n            onClickPreview={this.clickPreview}\n            useBeforeRead={true}\n          ></Uploader>\n          <View className=\"demo-margin-bottom\">\n            <Button type=\"primary\" onClick={this.uploadToCloud}>\n              上传至云存储\n            </Button>\n          </View>\n        </DemoBlock>\n      </Block>\n    )\n  }\n}\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar toString = require('../internals/to-string');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar createMethod = function (CONVERT_TO_STRING) {\n  return function ($this, pos) {\n    var S = toString(requireObjectCoercible($this));\n    var position = toIntegerOrInfinity(pos);\n    var size = S.length;\n    var first, second;\n    if (position < 0 || position >= size) return CONVERT_TO_STRING ? '' : undefined;\n    first = S.charCodeAt(position);\n    return first < 0xD800 || first > 0xDBFF || position + 1 === size\n      || (second = S.charCodeAt(position + 1)) < 0xDC00 || second > 0xDFFF\n        ? CONVERT_TO_STRING ? S.charAt(position) : first\n        : CONVERT_TO_STRING ? S.slice(position, position + 2) : (first - 0xD800 << 10) + (second - 0xDC00) + 0x10000;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.codePointAt` method\n  // https://tc39.es/ecma262/#sec-string.prototype.codepointat\n  codeAt: createMethod(false),\n  // `String.prototype.at` method\n  // https://github.com/mathiasbynens/String.prototype.at\n  charAt: createMethod(true)\n};\n","'use strict';\nvar charAt = require('../internals/string-multibyte').charAt;\nvar toString = require('../internals/to-string');\nvar InternalStateModule = require('../internals/internal-state');\nvar defineIterator = require('../internals/define-iterator');\n\nvar STRING_ITERATOR = 'String Iterator';\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(STRING_ITERATOR);\n\n// `String.prototype[@@iterator]` method\n// https://tc39.es/ecma262/#sec-string.prototype-@@iterator\ndefineIterator(String, 'String', function (iterated) {\n  setInternalState(this, {\n    type: STRING_ITERATOR,\n    string: toString(iterated),\n    index: 0\n  });\n// `%StringIteratorPrototype%.next` method\n// https://tc39.es/ecma262/#sec-%stringiteratorprototype%.next\n}, function next() {\n  var state = getInternalState(this);\n  var string = state.string;\n  var index = state.index;\n  var point;\n  if (index >= string.length) return { value: undefined, done: true };\n  point = charAt(string, index);\n  state.index += point.length;\n  return { value: point, done: false };\n});\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js!./index.js\"\nvar config = {\"navigationBarTitleText\":\"Uploader 文件上传\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/uploader/index', {root:{cn:[]}}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AAEA;AACA;;;;AAEA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAKA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAHA;AAMA;AACA;AACA;AAHA;AAlBA;AACA;AALA;AA+BA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AArCA;AACA;AADA;AAyCA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AA7CA;AACA;AADA;AAiDA;AAAA;AAAA;AAAA;AAjDA;AACA;AADA;AAqDA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAzDA;AACA;AADA;AACA;AADA;AA+DA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AADA;AAGA;AAAA;AAAA;AAGA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAOA;AAAA;AAAA;AAAA;AACA;AAAA;AARA;AAUA;AAjFA;AACA;AADA;AAqFA;AACA;AACA;AAFA;AArFA;AACA;AADA;AAEA;AACA;;;AAwFA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AADA;AASA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AADA;AASA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AADA;AAUA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAWA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAWA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAWA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AAAA;AAAA;AAAA;AATA;AADA;AAeA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAWA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AAAA;AACA;AAAA;AAAA;AAAA;AADA;AAVA;AAxFA;AA0GA;;;;AAlNA;AACA;;;;;;;;;;;;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}